<!DOCTYPE html>
<html>
<head>
  <title>Anthony's Library</title>
  <link rel="stylesheet" type="text/css" href="..\..\css\style.css"/>
</head>
<body>
  <div id="header">
    <h1>debouncing</h1>
  </div>
  <div id="container">
    <div id="content">
        <div id="nav">
          <h3> Navigation --> |
              <a href="..\..\index.html"> Home</a> |
              <a href="..\..\aboutme.html">About Me</a> |
              <a href="..\..\overview.html">Modules</a> |
        </div>
        <div id="main">
        <img src="..\..\media\debounce circuit.png" alt="debounce circuit">
        <xmp>
          //switching led color via button
          //controlling brightness via potential meter (soon tm)
          //reset after long press (3000ms)
          //13 - red, 12 - orange, 11 - green, 10 - white
          // 9 - button, - potential meter

          const int R=13, O=12,G=11, W=10, B=9;
          //R=red, O=orange,G=green, W=white, B=button
          int state, count, prevstate;
          //state= button state, count=tracking button count
          const int i=10, a=300;
          // i is for number of loops for flash, a is number of milliseconds delay
          int j=0;
          // j is the loop counter
          unsigned long prevt; //for timer -> t = time, prev=previous


          void setup()
          {
            pinMode(R,OUTPUT);
            pinMode(O,OUTPUT);
            pinMode(G,OUTPUT);
            pinMode(W,OUTPUT); //all these R,O,G,W for led
            pinMode(B,INPUT_PULLUP); //button, input_pulup -> 10k res
            Serial.begin(9600); //records value for monitoring
            prevt=millis();
          }

          void loop()
          {
            state=digitalRead(B);
            if (state==1)
            {
              prevstate=state;
              debounce();
              led();
            }
          }

          void debounce(){
            prevt=millis();
            while (state=1 && prevstate==state){
              Serial.println(state);
              state=digitalRead(B);
              if ((millis()-prevt)>3000){
                Serial.println("restarting");
                count=0;
    	          digitalWrite(R,LOW);
    	          digitalWrite(O,LOW);
    	          digitalWrite(G,LOW);
    	          digitalWrite(W,LOW);
                Serial.println("restart complete");
                delay(5000);
                break;
                }
              else {
                Serial.print(millis());
                Serial.print(" - ");
                Serial.print(prevt);
                Serial.print(" = ");
                Serial.println(millis()-prevt);
                Serial.println("not restart");
              }
            }
          }

          void led() {
            switch (count) {
              case 0:
    	         digitalWrite(R,LOW);
    	         digitalWrite(O,LOW);
    	         digitalWrite(G,LOW);
    	         digitalWrite(W,LOW);
    	         delay(a);
    	         count++;
               break;

              case 1:
               while (j<i){
                digitalWrite(R,HIGH);
                delay(a);
    	          digitalWrite(R,LOW);
    		        delay(a);
          	    digitalWrite(R,HIGH);
          	    delay(a);
      		      j++;
    	          }
    	          j=0;
    	          count++;
                break;

                case 2:
    	           digitalWrite(R,0);
    	           while (j<i){
    		          digitalWrite(O,HIGH);
    		          delay(a);
    		          digitalWrite(O,LOW);
    		          delay(a);
          	      digitalWrite(O,HIGH);
          	      delay(a);
                  j++;
    	            }
    	            j=0;
    	            count++;
                  break;

                  case 3:
    	             digitalWrite(R,0);
    	             digitalWrite(O,0);
    	             while (j<i){
    		              digitalWrite(G,HIGH);
    		              delay(a);
    		              digitalWrite(G,LOW);
    		              delay(a);
          	          digitalWrite(G,HIGH);
          	          delay(a);
                      j++;
    	                }
                   j=0;
    	             count++;
                   break;

                  case 4:
  	               digitalWrite(R,0);
                   digitalWrite(O,0);
                	 digitalWrite(G,0);
                   while (j<i){
                		digitalWrite(W,HIGH);
    	              delay(a);
    		            digitalWrite(W,LOW);
  		              delay(a);
          	        digitalWrite(W,HIGH);
        	          delay(a);
                    j++;
    	             }
    	             j=0;
    	             count=0;
                   break;

                default:
    	           digitalWrite(R,0);
    	           digitalWrite(O,0);
    	           digitalWrite(G,0);
    	           digitalWrite(W,0);
    	           delay(a);
                 break;
               }
             }
        </xmp>
        <iframe width="900" height="900" src="https://www.tinkercad.com/embed/ihwHMz7rtLb?editbtn=1" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>
        </div>
    </div>
  </div>
  <div id="footer">
    <h4><p><a href="..\arduino.html">Return to arudino page</a></p></h4>
  </div>
</body>
</html>
